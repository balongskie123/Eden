# .github/workflows/cmake_build.yml
name: C++ CMake CI Build

on:
  push:
    branches: [ "main", "master" ]
  pull_request:
    branches: [ "main", "master" ]

jobs:
  build:
    # Use a matrix to build on multiple operating systems
    strategy:
      matrix:
        os: [ubuntu-latest, windows-latest, macos-latest]
        build_type: [Debug, Release]
    
    runs-on: ${{ matrix.os }}

    steps:
      # Step 1: Check out the repository code
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          submodules: true # Important if the project uses Git submodules

      # Step 2: Install required dependencies (This step is often necessary for non-standard libs on Linux/macOS)
      # For a basic CMake project, this can be skipped, but included for robustness.
      - name: Install dependencies (Linux)
        if: runner.os == 'Linux'
        run: |
          sudo apt-get update
          # Example: sudo apt-get install libsdl2-dev
          # Add any external library dependencies here if they are not handled by the build system

      # Step 3: Configure CMake
      # Creates the build directory and generates build files (like Makefiles or Ninja files)
      - name: Configure CMake
        run: |
          cmake -S . -B build -DCMAKE_BUILD_TYPE=${{ matrix.build_type }}

      # Step 4: Build the project
      # Uses the generated files to compile the source code
      - name: Build
        run: cmake --build build --config ${{ matrix.build_type }} --parallel

      # Step 5: (Optional) Run tests if your project uses CTest/GoogleTest
      - name: Run Tests
        if: runner.os != 'Windows' # Skipping for Windows in this basic example due to potential setup complexity
        working-directory: ${{github.workspace}}/build
        run: ctest --output-on-failure
        
      # Step 6: (Optional) Upload the resulting executable/library as an artifact
      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: Eden-executable-${{ matrix.os }}-${{ matrix.build_type }}
          path: |
            build/
            # Update the path above to match the actual location and name of your executable/library
